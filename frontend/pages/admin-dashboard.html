<!-- admin-dashboard.html -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

<div class="container mt-4">
  <h3>Admin Dashboard</h3>

  <!-- Tabs -->
  <ul class="nav nav-tabs" id="adminTabs" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="users-tab" data-bs-toggle="tab" href="#usersTab" role="tab">Users</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="gigs-tab" data-bs-toggle="tab" href="#gigsTab" role="tab">Gigs</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="blogs-tab" data-bs-toggle="tab" href="#blogsTab" role="tab">Blogs</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="categories-tab" data-bs-toggle="tab" href="#categoriesTab" role="tab">Categories</a>
    </li>
  </ul>

  <!-- Tab Contents -->
  <div class="tab-content mt-3">
    <div class="tab-pane fade show active" id="usersTab" role="tabpanel"></div>
    <div class="tab-pane fade" id="gigsTab" role="tabpanel"></div>
    <div class="tab-pane fade" id="blogsTab" role="tabpanel"></div>
    <div class="tab-pane fade" id="categoriesTab" role="tabpanel"></div>
  </div>
</div>

<!-- Load jQuery, Bootstrap, and other scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  $(document).ready(function () {

    $.when(
      $.getScript("https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"),
      $.getScript("https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js")
    ).done(function () {
      console.log("‚úÖ DataTables JS loaded");

      // Load users partial and logic by default
      $('#usersTab').load('partials/admin-users.html', function () {
        $.getScript('services/admin-users.js')
          .done(function () {
            console.log('‚úÖ admin-users.js loaded.');
            initAdminUsers();
          })
          .fail(function () {
            console.error('‚ùå Failed to load admin-users.js');
          });
      });

      // Lazy-load partials for other tabs
      $('a[data-bs-toggle="tab"]').on('shown.bs.tab', function (e) {
        const targetId = $(e.target).attr('href');
        console.log('üîÑ Tab changed to:', targetId);

        if (targetId === '#gigsTab' && !$('#gigsTab').data('loaded')) {
          $('#gigsTab').load('partials/admin-gigs.html', function () {
            $.getScript('services/admin-gigs.js')
              .done(function () {
                console.log('‚úÖ admin-gigs.js loaded.');
                initAdminGigs();
                $('#gigsTab').data('loaded', true);
              })
              .fail(function () {
                console.error('‚ùå Failed to load admin-gigs.js');
              });
          });
        }

        if (targetId === '#blogsTab' && !$('#blogsTab').data('loaded')) {
          $('#blogsTab').load('partials/admin-blogs.html', function () {
            $.getScript('services/admin-blogs.js')
              .done(function () {
                console.log('‚úÖ admin-blogs.js loaded.');
                initAdminBlogs();
                $('#blogsTab').data('loaded', true);
              })
              .fail(function () {
                console.error('‚ùå Failed to load admin-blogs.js');
              });
          });
        }

        if (targetId === '#categoriesTab' && !$('#categoriesTab').data('loaded')) {
          $('#categoriesTab').load('partials/admin-categories.html', function () {
            $.getScript('services/admin-categories.js')
              .done(function () {
                console.log('‚úÖ admin-categories.js loaded.');
                initAdminCategories();
                $('#categoriesTab').data('loaded', true);
              })
              .fail(function () {
                console.error('‚ùå Failed to load admin-categories.js');
              });
          });
        }
      });
    }).fail(function () {
      console.error("‚ùå Failed to load DataTables JS");
    });
  });
</script>
